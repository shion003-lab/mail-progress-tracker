<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>MailPM Auth</title>
  <script src="https://alcdn.msauth.net/browser/2.38.0/js/msal-browser.min.js"></script>
</head>
<body>
  <h2>MailPM Authentication</h2>
  <button id="login">Microsoftにサインイン</button>

  <script>
    const msalConfig = {
      auth: {
        clientId: "6dab0e8b-444e-4740-9b93-0ec1f350d062",   // Azure ADで取得したクライアントID
        authority: "https://login.microsoftonline.com/c1521ad5-8d23-4d3c-a5c4-e90a535b3c2a",
        redirectUri: "https://shion003-lab.github.io/mail-progress-tracker/auth.html"
      }
    };

    const msalInstance = new msal.PublicClientApplication(msalConfig);

    const loginRequest = {
      scopes: ["User.Read", "Mail.ReadWrite"]
    };

document.getElementById("login").onclick = () => {
  // popup ではなく redirect を使用
  msalInstance.loginRedirect(loginRequest);
};

window.onload = async () => {
  try {
    const response = await msalInstance.handleRedirectPromise();
    if (response) {
      const account = response.account;
      msalInstance.setActiveAccount(account);

      const tokenResponse = await msalInstance.acquireTokenSilent({
        ...loginRequest,
        account
      });
      console.log("Access token:", tokenResponse.accessToken);
      alert("ログイン成功！トークン取得済み");
    }
  } catch (err) {
    console.error("Auth Error:", err);
    alert("トークン取得に失敗しました。コンソールを確認してください。");
  }
};
  </script>
</body>
</html>

